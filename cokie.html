<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cookie Example</title>
  <script>
    // 读取名为'sample'的cookie
    function getCookie(name) {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'http://127.0.0.1:3000/set-cookie');
      xhr.send();
      const cookies = xhr.getResponseHeader('Set-Cookie');
      if (document.cookie && document.cookie !== '') {
        // const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      // const cookies = null;
      xhr.onreadystatechange = function () {
        // readyState 是 xhr 对象中的属性, 表示状态 0 1 2 3 4
        //判断 (服务端返回了所有的结果)
        if (xhr.readyState === 4) {
          //判断响应状态码 200  404  403 401 500
          if (xhr.status >= 200 && xhr.status < 300) {
            // 处理结果 行 头 空行 体
            // 响应
            console.log('状态码', xhr.status); // 状态码
            console.log('状态字符串', xhr.statusText); // 状态字符串
            console.log('所有响应头', xhr.getAllResponseHeaders()); // 所有响应头
            console.log('响应体', xhr.response); // 响应体
            //设置 result 的文本
            result.innerHTML = xhr.response;
          }
        }
      }
      // let cookieValue = null;
      // if (document.cookie && document.cookie !== '') {
      //   const cookies = document.cookie.split(';');
      //   for (let i = 0; i < cookies.length; i++) {
      //     const cookie = cookies[i].trim();
      //     if (cookie.substring(0, name.length + 1) === (name + '=')) {
      //       cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
      //       break;
      //     }
      //   }
      // }
      return cookieValue;
    }

    // 显示cookie的值
    document.addEventListener('DOMContentLoaded', function () {
      const sampleCookie = getCookie('sample');
      if (sampleCookie) {
        document.getElementById('cookieValue').textContent = sampleCookie;
      }
    });
  </script>
</head>
<body>
  <h1>Cookie Value:</h1>
  <p id="cookieValue"></p>
</body>
</html>